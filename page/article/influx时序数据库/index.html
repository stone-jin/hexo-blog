<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>Influx时序数据库 | 大米小米的博客</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="typescript, nodejs, javascript, webpack, 前端, 全栈开发"><meta name="description" content="日常学习与兴趣交流的个人博客"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://blog.fedfans.com/page/article/influx时序数据库/index.html"><link rel="icon" type="image/png" href="https://user-images.githubusercontent.com/6525544/44798832-169c4280-abe5-11e8-8b7c-618aee212586.png" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="大米小米的博客"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f1e4c915dd718aa486135ab51167ad12";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(http://520stone-blog.oss-cn-beijing.aliyuncs.com/blog_fedfans/loading.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="大米小米的博客" alt="大米小米的博客" style="color:#fff;text-decoration:none">大米小米的博客</a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="https://520stone-blog.oss-cn-beijing.aliyuncs.com/blog_fedfans/WX20190508-143057.png" alt="Influx时序数据库"></div><header class="post__info"><h1 class="post__title">Influx时序数据库</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="https://www.github.com/stone-jin">金炳</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2019-05-07</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/数据库/">数据库</a></li><li class="mark__item"><a href="/tags/Influx/">Influx</a></li></ul></div></div></header><div class="post__content"><h1 id="InfluxDB–时序数据库"><a href="#InfluxDB–时序数据库" class="headerlink" title="InfluxDB–时序数据库"></a>InfluxDB–时序数据库</h1><p><a name="xaMqU"></a></p><h2 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h2><p>InfluxDB 是用Go语言编写的一个开源分布式时序、事件和指标数据库，无需外部依赖。</p><p>类似的数据库有Elasticsearch、Graphite等。<br><strong>其主要特色功能</strong></p><ol><li>基于时间序列，支持与时间有关的相关函数（如最大，最小，求和等）</li><li>可度量性：你可以实时对大量数据进行计算</li><li>基于事件：它支持任意的事件数据</li></ol><p><strong>InfluxDB的主要特点</strong></p><ol><li>无结构（无模式）：可以是任意数量的列</li><li>可拓展的</li><li>支持min, max, sum, count, mean, median 等一系列函数，方便统计</li><li>原生的HTTP支持，内置HTTP API</li><li>强大的类SQL语法<br><a name="gCDFr"></a><h3 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1 概念"></a>1.1 概念</h3><a name="SySGA"></a><h4 id="1-1-1-与传统数据库的名词做比较"><a href="#1-1-1-与传统数据库的名词做比较" class="headerlink" title="1.1.1 与传统数据库的名词做比较"></a>1.1.1 与传统数据库的名词做比较</h4><img src="https://cdn.nlark.com/yuque/0/2019/png/187105/1557135823326-4ba86192-d5dc-42c1-aaad-2cf86c04e575.png#align=left&amp;display=inline&amp;height=187&amp;name=image.png&amp;originHeight=187&amp;originWidth=654&amp;size=18068&amp;status=done&amp;width=654" alt="image.png"><br><a name="GGjEM"></a><h4 id="1-1-2-influx独有的概念"><a href="#1-1-2-influx独有的概念" class="headerlink" title="1.1.2 influx独有的概念"></a>1.1.2 influx独有的概念</h4><strong>Point</strong><br>Point由时间戳（time）、数据（field）、标签（tags）组成。<br>Point相当于传统数据库里的一行数据，如下表所示：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/187105/1557135982313-63f36773-d447-4eda-88bf-f8a7366c0a36.png#align=left&amp;display=inline&amp;height=235&amp;name=image.png&amp;originHeight=235&amp;originWidth=627&amp;size=28123&amp;status=done&amp;width=627" alt="image.png"><br>influxdb 的时间精度是纳秒。这个跟prometheus不一样，prometheus是毫秒。这点也注意一下。<br>此处是重点，就是我们插入一条数据，使用的是:</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert disk_free,xxx=1,yyy=2 value=3,age=18</span><br></pre></td></tr></table></figure><p>其中xxx和yyy是tags，而value和age是fields。<br>对于我们要检索的条件来说，我们要符合以下结构：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select value,xxx from disk_free where xxx=1</span><br></pre></td></tr></table></figure><p>select的第一个要是fields的名字，第二个才能是对应tags的名字，而且后续条件那块要以tags，虽然后面where的条件也能对fields进行检索。<br>所以下面这种情况是不对的:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select xxx from disk_free</span><br></pre></td></tr></table></figure><p>但是往往我们是根据对应的tag进行group化：<br>所以我们会用下面这种情况</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select value,yyy from disk_free group by xxx</span><br></pre></td></tr></table></figure><p>这样我们如果使用到grafana就变成了两个折线图。<br><strong>series</strong><br>所有在数据库中的数据，都需要通过图表来展示，而这个series表示这个表里面的数据，可以在图表上画成几条线：通过tags排列组合算出来。<br>我们可以通过下面命令来查看某一个表的series</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show series from xxx</span><br></pre></td></tr></table></figure><p>或者查看整个database的series</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show series</span><br></pre></td></tr></table></figure><p><a name="h0hER"></a></p><h2 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h2><p><a name="fk2Px"></a></p><h3 id="2-1-docker方式安装"><a href="#2-1-docker方式安装" class="headerlink" title="2.1 docker方式安装"></a>2.1 docker方式安装</h3><p><a href="https://hub.docker.com/_/influxdb" target="_blank" rel="noopener">https://hub.docker.com/_/influxdb</a><br>安装：<br>docker run -itd -p 8086:8086 influxdb<br>然后我们进入容器内部，如下:<br>docker exec -it ${containerId} bash<br>然后执行influx这个客户端，可以连接InfluxDB的server端进行操作。<br><a name="e5fBX"></a></p><h3 id="2-2-普通方式安装"><a href="#2-2-普通方式安装" class="headerlink" title="2.2 普通方式安装"></a>2.2 普通方式安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">OS X (via Homebrew)</span><br><span class="line">brew update</span><br><span class="line">brew install influxdb</span><br><span class="line">MD5: 4f0aa76fee22cf4c18e2a0779ba4f462</span><br><span class="line"></span><br><span class="line">Ubuntu &amp; Debian (64-bit)</span><br><span class="line"></span><br><span class="line">wget https://dl.influxdata.com/influxdb/releases/influxdb_0.13.0_amd64.deb</span><br><span class="line">sudo dpkg -i influxdb_0.13.0_amd64.deb</span><br><span class="line">MD5: bcca4c91bbd8e7f60e4a8325be67a08a</span><br><span class="line"></span><br><span class="line">Ubuntu &amp; Debian (ARM)</span><br><span class="line"></span><br><span class="line">wget https://dl.influxdata.com/influxdb/releases/influxdb_0.13.0_armhf.deb</span><br><span class="line">sudo dpkg -i influxdb_0.13.0_armhf.deb</span><br><span class="line">MD5: b64ada82b6abf5d6382ed08dde1e8579</span><br><span class="line"></span><br><span class="line">RedHat &amp; CentOS (64-bit)</span><br><span class="line">wget https://dl.influxdata.com/influxdb/releases/influxdb-0.13.0.x86_64.rpm</span><br><span class="line">sudo yum localinstall influxdb-0.13.0.x86_64.rpm</span><br><span class="line">MD5: 286b6c18aa4ef37225ea6605a729b61d</span><br><span class="line"></span><br><span class="line">RedHat &amp; CentOS (ARM)</span><br><span class="line">wget https://dl.influxdata.com/influxdb/releases/influxdb-0.13.0.armhf.rpm</span><br><span class="line">sudo yum localinstall influxdb-0.13.0.armhf.rpm</span><br><span class="line">MD5: 4cf99debb5315fbbb26166506807d965</span><br><span class="line"></span><br><span class="line">Standalone Binaries (64-bit)</span><br><span class="line">wget https://dl.influxdata.com/influxdb/releases/influxdb-0.13.0_linux_amd64.tar.gz</span><br><span class="line">tar xvfz influxdb-0.13.0_linux_amd64.tar.gz</span><br><span class="line">MD5: 187854536393c67f7793ada1c096da8e</span><br><span class="line"></span><br><span class="line">Standalone Binaries (ARM)</span><br><span class="line">wget https://dl.influxdata.com/influxdb/releases/influxdb-0.13.0_linux_armhf.tar.gz</span><br><span class="line">tar xvfz influxdb-0.13.0_linux_armhf.tar.gz</span><br><span class="line"></span><br><span class="line">Docker Image</span><br><span class="line">docker pull influxdb</span><br></pre></td></tr></table></figure><p><a name="yhRXE"></a></p><h3 id="2-3-路径说明"><a href="#2-3-路径说明" class="headerlink" title="2.3 路径说明"></a>2.3 路径说明</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/influxdb/influxdb.conf 默认的配置文件</span><br><span class="line">/var/log/influxdb/influxd.log 日志文件</span><br><span class="line">/var/lib/influxdb/data 数据文件</span><br><span class="line">/usr/lib/influxdb/scripts 初始化脚本文件夹</span><br><span class="line">/usr/bin/influx 启动数据库</span><br></pre></td></tr></table></figure><p><a name="wLgHq"></a></p><h2 id="三、基本操作"><a href="#三、基本操作" class="headerlink" title="三、基本操作"></a>三、基本操作</h2><p><a name="Mnz9b"></a></p><h3 id="3-1-使用客户端influx"><a href="#3-1-使用客户端influx" class="headerlink" title="3.1 使用客户端influx"></a>3.1 使用客户端influx</h3><p>以docker的为例，我们前面已经安装了对应的influx，然后我们登录容器内部</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it $&#123;containerID&#125; bash</span><br></pre></td></tr></table></figure><p>然后进来后，我们执行influx –version可以查看对应的版本。<br>使用influx可以用这个客户端连接InfluxDB。<br><a name="mEe4t"></a></p><h3 id="3-2-数据库操作"><a href="#3-2-数据库操作" class="headerlink" title="3.2 数据库操作"></a>3.2 数据库操作</h3><p><a name="i4LpV"></a></p><h4 id="3-2-1-查看数据库"><a href="#3-2-1-查看数据库" class="headerlink" title="3.2.1 查看数据库"></a>3.2.1 查看数据库</h4><p>通过以下命令，我们可以查看一共有哪些databases。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases</span><br></pre></td></tr></table></figure><p></p><p><a name="Jrk4Z"></a></p><h4 id="3-2-2-新增数据库"><a href="#3-2-2-新增数据库" class="headerlink" title="3.2.2 新增数据库"></a>3.2.2 新增数据库</h4><p>我们通过create database操作来新建一个数据库。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database test</span><br></pre></td></tr></table></figure><p></p><p><a name="6m3Ar"></a></p><h4 id="3-2-3-删除数据库"><a href="#3-2-3-删除数据库" class="headerlink" title="3.2.3 删除数据库"></a>3.2.3 删除数据库</h4><p>我们通过drop database操作来删除一个数据库。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database test</span><br></pre></td></tr></table></figure><p><a name="B2oAN"></a></p><h4 id="3-2-4-使用数据库"><a href="#3-2-4-使用数据库" class="headerlink" title="3.2.4 使用数据库"></a>3.2.4 使用数据库</h4><p>我们可以通过use database来使用一个数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use database</span><br></pre></td></tr></table></figure><p><a name="7O8Jw"></a></p><h3 id="3-3-measurement操作"><a href="#3-3-measurement操作" class="headerlink" title="3.3 measurement操作"></a>3.3 measurement操作</h3><p><a name="WjyUZ"></a></p><h4 id="3-3-1-查看measurement"><a href="#3-3-1-查看measurement" class="headerlink" title="3.3.1 查看measurement"></a>3.3.1 查看measurement</h4><p>查看measurement其实相当于我们原来的查看有多少table一样。<br>执行的语句是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show measurements</span><br></pre></td></tr></table></figure><p><a name="vzUzt"></a></p><h4 id="3-3-2-新增measurement"><a href="#3-3-2-新增measurement" class="headerlink" title="3.3.2 新增measurement"></a>3.3.2 新增measurement</h4><p>没有显示的创建measurement的操作，我们只要插入了对应的数据就会创建对应的measurement</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert disk_free,hostname=server01 value=442221834240i</span><br></pre></td></tr></table></figure><p>最后的时间，不需要我们进行插入，这个是会自己生成的。<br><a name="pAvhv"></a></p><h4 id="3-3-3-删除measurement"><a href="#3-3-3-删除measurement" class="headerlink" title="3.3.3 删除measurement"></a>3.3.3 删除measurement</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop measurement disk_free</span><br></pre></td></tr></table></figure><p><a name="MiCeF"></a></p><h4 id="3-3-4-查询measurement的数据"><a href="#3-3-4-查询measurement的数据" class="headerlink" title="3.3.4 查询measurement的数据"></a>3.3.4 查询measurement的数据</h4><p>如下我们来查询disk_free这个measurement的数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from disk_free</span><br></pre></td></tr></table></figure><p><a name="u8GEM"></a></p><h3 id="3-4-新增数据"><a href="#3-4-新增数据" class="headerlink" title="3.4 新增数据"></a>3.4 新增数据</h3><p><a name="WIrhU"></a></p><h4 id="3-4-1-新增数据"><a href="#3-4-1-新增数据" class="headerlink" title="3.4.1 新增数据"></a>3.4.1 新增数据</h4><p>如下，进行增加数据，如果measurement没有存在，则会创建这个measurement。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert disk_free,hostname=server01 value=442221834240i</span><br></pre></td></tr></table></figure><p></p><p>时序数据库的特点，决定没有删除和修改操作，所以这块并没有这两块的说明。<br>增加数据采用insert的方式，要注意的是 InfluxDB的insert中，表名与数据之间用逗号（,）分隔，tag和field之间用 空格分隔，多个tag或者多个field之间用逗号（,）分隔。<br>在上面那条语句中，disk_free是表名,hostname=server01是tag，属于索引，value=xx是field，这个可以随意写，随意定义。<br><a name="jcMPO"></a></p><h4 id="3-4-2-数据查询"><a href="#3-4-2-数据查询" class="headerlink" title="3.4.2 数据查询"></a>3.4.2 数据查询</h4><p>此处是重点，就是我们插入一条数据，使用的是:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert disk_free,xxx=1,yyy=2 value=3,age=18</span><br></pre></td></tr></table></figure><p>其中xxx和yyy是tags，而value和age是fields。<br><strong>情况一：</strong><br>对于我们要检索的条件来说，我们要符合以下结构：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select value,xxx from disk_free where xxx=1</span><br></pre></td></tr></table></figure><p>select的第一个要是fields的名字，第二个才能是对应tags的名字，而且后续条件那块要以tags，虽然后面where的条件也能对fields进行检索。<br>所以下面这种情况是不对的:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select xxx from disk_free</span><br></pre></td></tr></table></figure><p><strong>情况二：</strong><br>但是往往我们是根据对应的tag进行group化：<br>所以我们会用下面这种情况</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select value,yyy from disk_free group by xxx</span><br></pre></td></tr></table></figure><p>这样我们如果使用到grafana就变成了两个折线图。<br><strong>情况三：</strong><br>有时候group by xxx的时候，我们需要剔除掉某些不符合数据规范的数据，就可以用下面这个方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select value from disk_free where xxx!=&apos;&apos; group by xxx</span><br></pre></td></tr></table></figure><p>这样就会把那些xxx为空的数据给剔除掉了，这样我们的折线图就去掉了某些干扰项。<br><strong>情况四：</strong><br>有时候，我们要制作饼图，这时候其实是按tag进行比例的划分，所以这时候的语句应该是如下的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(value) from disk_free group by xxx</span><br></pre></td></tr></table></figure><p>那这个时候，其实也能剔除掉对应的一些垃圾数据，类似于情况三的操作方式。<br><strong>情况五</strong><br>有时候我们只要展示xxx的某几种情况，不仅仅是情况三那种干扰某一个，比如我们需要包含几项。这时候我们会用正则进行匹配。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select value from disk_free where xxx =~ /^(111|222)$/ group by xxx</span><br></pre></td></tr></table></figure><p>这时候，111|222，我们可以通过grafana的变量来进行解决，所以上面的语句最终变成了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select value from disk_free where xxx =~ /^$xxx$/ group by xxx</span><br></pre></td></tr></table></figure><p>上面的$xxx会最终变成(111|222)，而/^$|则是一个正则。<br><a name="Zj5fq"></a></p><h3 id="3-5-连续查询"><a href="#3-5-连续查询" class="headerlink" title="3.5 连续查询"></a>3.5 连续查询</h3><p>InfluxDB的连续查询是在数据库中自动定时启动的一组语句，语句中必须包含SELECT关键词和GROUP BY time()关键词。<br>InfluxDB会将查询结果放到指定的数据表中。</p><p><strong>目的：</strong><br>使用连续查询是最优的降低采样率的方式，连续查询和存储策略搭配使用将会大大降低InfluxDB的系统占用量。<br>而且使用连续查询后，数据会存放到指定的数据库中，这样就为以后统计不同京都的数据提供了方便。<br><a name="JD49G"></a></p><h4 id="3-5-1-新增连续查询"><a href="#3-5-1-新增连续查询" class="headerlink" title="3.5.1 新增连续查询"></a>3.5.1 新增连续查询</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY &lt;cq_name&gt; ON &lt;database_name&gt; </span><br><span class="line">[RESAMPLE [EVERY &lt;interval&gt;] [FOR &lt;interval&gt;]] </span><br><span class="line">BEGIN SELECT &lt;<span class="keyword">function</span>&gt;(&lt;stuff&gt;)[,&lt;<span class="keyword">function</span>&gt;(&lt;stuff&gt;)] INTO &lt;different_measurement&gt; </span><br><span class="line">FROM &lt;current_measurement&gt; [WHERE &lt;stuff&gt;] GROUP BY time(&lt;interval&gt;)[,&lt;stuff&gt;] </span><br><span class="line">END</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY cq_30m ON telegraf BEGIN SELECT mean(used) INTO mem_used_30m FROM mem GROUP BY time(30m) END</span><br></pre></td></tr></table></figure><p><a name="21GVL"></a></p><h4 id="3-5-2-删除连续查询"><a href="#3-5-2-删除连续查询" class="headerlink" title="3.5.2 删除连续查询"></a>3.5.2 删除连续查询</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP CONTINUOUS QUERY &lt;cq_name&gt; ON &lt;database_name&gt;</span><br></pre></td></tr></table></figure><p><a name="SVuLR"></a></p><h4 id="3-5-3-查询连续查询"><a href="#3-5-3-查询连续查询" class="headerlink" title="3.5.3 查询连续查询"></a>3.5.3 查询连续查询</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CONTINUOUS QUERIES</span><br></pre></td></tr></table></figure><p><a name="nijqw"></a></p><h3 id="3-6-InfluxDB常用函数使用"><a href="#3-6-InfluxDB常用函数使用" class="headerlink" title="3.6 InfluxDB常用函数使用"></a>3.6 InfluxDB常用函数使用</h3><p><a name="Av8sn"></a></p><h4 id="3-6-1-聚合类函数"><a href="#3-6-1-聚合类函数" class="headerlink" title="3.6.1 聚合类函数"></a>3.6.1 聚合类函数</h4><ul><li><strong>count()函数</strong></li></ul><p>返回一个（field）字段中的非空值的数量。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(&lt;field_key&gt;) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;SELECT COUNT(water_level) FROM h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           count</span><br><span class="line">1970-01-01T00:00:00Z     15258</span><br></pre></td></tr></table></figure><p>如果想要指定时间:<br>示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT COUNT(water_level) FROM h2o_feet WHERE time &gt;= &apos;2015-08-18T00:00:00Z&apos; AND time &lt; &apos;2015-09-18T17:00:00Z&apos; GROUP BY time(4d)</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           count</span><br><span class="line">2015-08-17T00:00:00Z     1440</span><br><span class="line">2015-08-21T00:00:00Z     1920</span><br><span class="line">2015-08-25T00:00:00Z     1920</span><br><span class="line">2015-08-29T00:00:00Z     1920</span><br><span class="line">2015-09-02T00:00:00Z     1915</span><br><span class="line">2015-09-06T00:00:00Z     1920</span><br><span class="line">2015-09-10T00:00:00Z     1920</span><br><span class="line">2015-09-14T00:00:00Z     1920</span><br><span class="line">2015-09-18T00:00:00Z     335</span><br></pre></td></tr></table></figure><p>这样结果是按照时间划分的。</p><ul><li><strong>Distinct()函数</strong></li></ul><p>返回一个字段（field）的唯一值。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT(&lt;field_key&gt;) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>使用示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT DISTINCT(&quot;level description&quot;) FROM h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           distinct</span><br><span class="line">1970-01-01T00:00:00Z     between 6 and 9 feet</span><br><span class="line">1970-01-01T00:00:00Z     below 3 feet</span><br><span class="line">1970-01-01T00:00:00Z     between 3 and 6 feet</span><br><span class="line">1970-01-01T00:00:00Z     at or greater than 9 feet</span><br></pre></td></tr></table></figure><p>这个例子显示level description这个字段共有四个值，然后将其显示了出来，时间为默认时间。</p><ul><li><strong>MEAN()函数</strong></li></ul><p>返回一个字段（field）中的值的算术平均值（平均值）。字段类型必须是长整型或float64。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT MEAN(&lt;field_key&gt;) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT MEAN(water_level) FROM h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           mean</span><br><span class="line">1970-01-01T00:00:00Z     4.286791371454075</span><br></pre></td></tr></table></figure><p>说明water_level字段的平均值为<code>4.286791371454075</code></p><ul><li><strong>MEDIAN()函数</strong></li></ul><p>从单个字段（field）中的排序值返回中间值（中位数）。字段值的类型必须是长整型或float64格式。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT MEDIAN(&lt;field_key&gt;) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>使用示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT MEDIAN(water_level) from h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           median</span><br><span class="line">1970-01-01T00:00:00Z     4.124</span><br></pre></td></tr></table></figure><p>说明表中water_level字段的中位数是4.124</p><ul><li><strong>SPREEAD()函数</strong></li></ul><p>返回字段的最小值和最大值之间的差值。数据的类型必须是长整型或float64。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT SPREAD(&lt;field_key&gt;) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>使用示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT SPREAD(water_level) FROM h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                            spread</span><br><span class="line">1970-01-01T00:00:00Z      10.574</span><br></pre></td></tr></table></figure><ul><li><strong>SUM()函数</strong></li></ul><p>返回一个字段中的所有值的和。字段的类型必须是长整型或float64。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT SUM(&lt;field_key&gt;) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>使用示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT SUM(water_level) FROM h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           sum</span><br><span class="line">1970-01-01T00:00:00Z     67777.66900000002</span><br></pre></td></tr></table></figure><p>此语句计算出了 h2o_feet表中 所有 water_level 字段的和。<br><a name="ZyrXM"></a></p><h4 id="3-6-2-选择类函数"><a href="#3-6-2-选择类函数" class="headerlink" title="3.6.2 选择类函数"></a>3.6.2 选择类函数</h4><ul><li><strong>TOP()函数</strong></li></ul><p>作用：返回一个字段中最大的N个值，字段类型必须是长整型或float64类型。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT TOP( &lt;field_key&gt;[,&lt;tag_key(s)&gt;],&lt;N&gt; )[,&lt;tag_key(s)&gt;|&lt;field_key(s)&gt;] [INTO_clause] FROM_clause [WHERE_clause] [GROUP_BY_clause] [ORDER_BY_clause] [LIMIT_clause] [OFFSET_clause] [SLIMIT_clause] [SOFFSET_clause]</span><br></pre></td></tr></table></figure><p>使用示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT TOP(&quot;water_level&quot;,3) FROM &quot;h2o_feet&quot;</span><br><span class="line"></span><br><span class="line">name: h2o_feet</span><br><span class="line">time                   top</span><br><span class="line">----                   ---</span><br><span class="line">2015-08-29T07:18:00Z   9.957</span><br><span class="line">2015-08-29T07:24:00Z   9.964</span><br><span class="line">2015-08-29T07:30:00Z   9.954</span><br></pre></td></tr></table></figure><p>这个示例返回表中water_level字段中最大的三个值。</p><ul><li><strong>BUTTOM()函数</strong></li></ul><p>作用：返回一个字段中最小的N个值。字段类型必须是长整型或float64类型。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT BOTTOM(&lt;field_key&gt;[,&lt;tag_keys&gt;],&lt;N&gt;)[,&lt;tag_keys&gt;] FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>使用示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT BOTTOM(water_level,3) FROM h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           bottom</span><br><span class="line">2015-08-29T14:30:00Z     -0.61</span><br><span class="line">2015-08-29T14:36:00Z     -0.591</span><br><span class="line">2015-08-30T15:18:00Z     -0.594</span><br></pre></td></tr></table></figure><p>这个例子返回表中water_level字段中最小的三个值。<br>也可将关联的tag放在一起查询，但如果tag值少于N的值，则返回的值的个数只会取tag中字段值少的那个。<br>例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT BOTTOM(water_level,location,3) FROM h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           bottom     location</span><br><span class="line">2015-08-29T10:36:00Z     -0.243     santa_monica</span><br><span class="line">2015-08-29T14:30:00Z     -0.61      coyote_creek</span><br></pre></td></tr></table></figure><p>语句取最小的三个值，然而结果只返回了2个值，因为location这个tag只有两个取值。</p><ul><li><strong>First()函数</strong></li></ul><p>作用：返回一个字段中最老的取值。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT FIRST(&lt;field_key&gt;)[,&lt;tag_key(s)&gt;] FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT FIRST(water_level) FROM h2o_feet WHERE location = &apos;santa_monica&apos;</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           first</span><br><span class="line">2015-08-18T00:00:00Z     2.064</span><br></pre></td></tr></table></figure><p>这个语句返回了在location=’santa_monica’条件下，最旧的那个water_level的取值和时间。</p><ul><li><strong>Last()函数</strong></li></ul><p>作用：返回一个字段中最新的取值。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT LAST(&lt;field_key&gt;)[,&lt;tag_key(s)&gt;] FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT LAST(water_level),location FROM h2o_feet WHERE time &gt;= &apos;2015-08-18T00:42:00Z&apos; and time &lt;= &apos;2015-08-18T00:54:00Z&apos;</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           last      location</span><br><span class="line">2015-08-18T00:54:00Z     6.982     coyote_creek</span><br></pre></td></tr></table></figure><ul><li><strong>MAX()函数</strong></li></ul><p>作用：返回一个字段中的最大值。该字段类型必须是长整型，float64，或布尔类型。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT MAX(&lt;field_key&gt;)[,&lt;tag_key(s)&gt;] FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT MAX(water_level),location FROM h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           max       location</span><br><span class="line">2015-08-29T07:24:00Z     9.964     coyote_creek</span><br></pre></td></tr></table></figure><ul><li><strong>MIN 函数</strong></li></ul><p>作用：返回一个字段中的最小值。该字段类型必须是长整型，float64，或布尔类型。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT MIN(&lt;field_key&gt;)[,&lt;tag_key(s)&gt;] FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT MIN(water_level),location FROM h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                          min       location</span><br><span class="line">2015-08-29T14:30:00Z    -0.61     coyote_creek</span><br></pre></td></tr></table></figure><ul><li><strong>PRECENTILE()函数</strong></li></ul><p>作用：返回排序值排位为N的百分值。字段的类型必须是长整型或float64。<br>百分值是介于100到0之间的整数或浮点数，包括100。</p><p>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT PERCENTILE(&lt;field_key&gt;, &lt;N&gt;)[,&lt;tag_key(s)&gt;] FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT PERCENTILE(water_level,5),location FROM h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                      percentile     location</span><br><span class="line">2015-08-28T12:06:00Z      1.122             santa_monica</span><br></pre></td></tr></table></figure><p>就是将water_level字段按照不同的location求百分比，然后取第五位数据。<br><a name="sUi2Z"></a></p><h4 id="3-6-2-变换类函数"><a href="#3-6-2-变换类函数" class="headerlink" title="3.6.2 变换类函数"></a>3.6.2 变换类函数</h4><ul><li><strong>DERIVATIVE()函数</strong></li></ul><p>作用：返回一个字段在一个series中的变化率。<br>InfluxDB会计算按照时间进行排序的字段值之间的<a href="https://www.linuxdaxue.com/tag/%e5%b7%ae%e5%bc%82/" target="_blank" rel="noopener">差异</a>，并将这些结果转化为单位变化率。其中，单位可以指定，默认为1s。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DERIVATIVE(&lt;field_key&gt;, [&lt;unit&gt;]) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>其中unit取值可以为以下几种：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">u --microseconds</span><br><span class="line">s --seconds</span><br><span class="line">m --minutes</span><br><span class="line">h --hours</span><br><span class="line">d --days</span><br><span class="line">w --weeks</span><br></pre></td></tr></table></figure><p>DERIVATIVE()函数还可以在GROUP BY time()的条件下与聚合函数嵌套使用，格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DERIVATIVE(AGGREGATION_FUNCTION(&lt;field_key&gt;),[&lt;unit&gt;]) FROM &lt;measurement_name&gt; WHERE &lt;stuff&gt; GROUP BY time(&lt;aggregation_interval&gt;)</span><br></pre></td></tr></table></figure><p>示例：<br>假设location = santa_monica 条件下数据有以下几条：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           water_level</span><br><span class="line">2015-08-18T00:00:00Z     2.064</span><br><span class="line">2015-08-18T00:06:00Z     2.116</span><br><span class="line">2015-08-18T00:12:00Z     2.028</span><br><span class="line">2015-08-18T00:18:00Z     2.126</span><br><span class="line">2015-08-18T00:24:00Z     2.041</span><br><span class="line">2015-08-18T00:30:00Z     2.051</span><br></pre></td></tr></table></figure><p>计算每一秒的变化率</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT DERIVATIVE(water_level) FROM h2o_feet WHERE location = &apos;santa_monica&apos; LIMIT 5</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           derivative</span><br><span class="line">2015-08-18T00:06:00Z     0.00014444444444444457</span><br><span class="line">2015-08-18T00:12:00Z     -0.00024444444444444465</span><br><span class="line">2015-08-18T00:18:00Z     0.0002722222222222218</span><br><span class="line">2015-08-18T00:24:00Z     -0.000236111111111111</span><br><span class="line">2015-08-18T00:30:00Z     2.777777777777842e-05</span><br></pre></td></tr></table></figure><p>第一行数据的计算公式为<code>(2.116 - 2.064) / (360s / 1s)</code><br>计算每六分钟的变化率</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT DERIVATIVE(water_level,6m) FROM h2o_feet WHERE location = &apos;santa_monica&apos; LIMIT 5</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           derivative</span><br><span class="line">2015-08-18T00:06:00Z     0.052000000000000046</span><br><span class="line">2015-08-18T00:12:00Z     -0.08800000000000008</span><br><span class="line">2015-08-18T00:18:00Z     0.09799999999999986</span><br><span class="line">2015-08-18T00:24:00Z     -0.08499999999999996</span><br><span class="line">2015-08-18T00:30:00Z     0.010000000000000231</span><br></pre></td></tr></table></figure><p>第一行数据的计算过程如下：<code>(2.116 - 2.064) / (6m / 6m)</code><br>计算每12分钟的变化率：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT DERIVATIVE(water_level,12m) FROM h2o_feet WHERE location = &apos;santa_monica&apos; LIMIT 5</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           derivative</span><br><span class="line">2015-08-18T00:06:00Z     0.10400000000000009</span><br><span class="line">2015-08-18T00:12:00Z     -0.17600000000000016</span><br><span class="line">2015-08-18T00:18:00Z     0.19599999999999973</span><br><span class="line">2015-08-18T00:24:00Z     -0.16999999999999993</span><br><span class="line">2015-08-18T00:30:00Z     0.020000000000000462</span><br></pre></td></tr></table></figure><p>第一行数据计算过程为：<code>(2.116 - 2.064 / (6m / 12m)</code><br>计算每12分钟最大值的变化率</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT DERIVATIVE(MAX(water_level)) FROM h2o_feet WHERE location = &apos;santa_monica&apos; AND time &gt;= &apos;2015-08-18T00:00:00Z&apos; AND time &lt; &apos;2015-08-18T00:36:00Z&apos; GROUP BY time(12m)</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           derivative</span><br><span class="line">2015-08-18T00:12:00Z     0.009999999999999787</span><br><span class="line">2015-08-18T00:24:00Z     -0.07499999999999973</span><br></pre></td></tr></table></figure><p>这个函数功能非常多，也非常复杂，更多对于此功能的详细解释请看官网：<a href="https://docs.influxdata.com/influxdb/v0.13/query_language/functions/#derivative" target="_blank" rel="noopener">https://docs.influxdata.com/influxdb/v0.13/query_language/functions/#derivative</a></p><ul><li><strong>DIFFERENCE()函数</strong></li></ul><p>作用：返回一个字段中连续的时间值之间的<a href="https://www.linuxdaxue.com/tag/%e5%b7%ae%e5%bc%82/" target="_blank" rel="noopener">差异</a>。字段类型必须是长整型或float64。<br>最基本的语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DIFFERENCE(&lt;field_key&gt;) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>与GROUP BY time()以及其他嵌套函数一起使用的语法格式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DIFFERENCE(&lt;function&gt;(&lt;field_key&gt;)) FROM &lt;measurement_name&gt; WHERE &lt;stuff&gt; GROUP BY time(&lt;time_interval&gt;)</span><br></pre></td></tr></table></figure><p>其中，函数可以包含以下几个：<br><code>COUNT()</code>, <code>MEAN()</code>, <code>MEDIAN()</code>,<code>SUM()</code>, <code>FIRST()</code>, <code>LAST()</code>, <code>MIN()</code>, <code>MAX()</code>, 和 <code>PERCENTILE()。</code><br>使用示例<br>例子中使用的源数据如下所示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT water_level FROM h2o_feet WHERE location=&apos;santa_monica&apos; AND time &gt;= &apos;2015-08-18T00:00:00Z&apos; and time &lt;= &apos;2015-08-18T00:36:00Z&apos;</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                            water_level</span><br><span class="line">2015-08-18T00:00:00Z      2.064</span><br><span class="line">2015-08-18T00:06:00Z      2.116</span><br><span class="line">2015-08-18T00:12:00Z      2.028</span><br><span class="line">2015-08-18T00:18:00Z      2.126</span><br><span class="line">2015-08-18T00:24:00Z      2.041</span><br><span class="line">2015-08-18T00:30:00Z      2.051</span><br><span class="line">2015-08-18T00:36:00Z      2.067</span><br></pre></td></tr></table></figure><p>计算water_level间的差异：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT DIFFERENCE(water_level) FROM h2o_feet WHERE location=&apos;santa_monica&apos; AND time &gt;= &apos;2015-08-18T00:00:00Z&apos; and time &lt;= &apos;2015-08-18T00:36:00Z&apos;</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                            difference</span><br><span class="line">2015-08-18T00:06:00Z      0.052000000000000046</span><br><span class="line">2015-08-18T00:12:00Z      -0.08800000000000008</span><br><span class="line">2015-08-18T00:18:00Z      0.09799999999999986</span><br><span class="line">2015-08-18T00:24:00Z      -0.08499999999999996</span><br><span class="line">2015-08-18T00:30:00Z      0.010000000000000231</span><br><span class="line">2015-08-18T00:36:00Z      0.016000000000000014</span><br><span class="line">数据类型都为float类型。</span><br></pre></td></tr></table></figure><ul><li><strong>ELAPSED()函数</strong></li></ul><p>作用：返回一个字段在连续的时间间隔间的差异，间隔单位可选，默认为1纳秒。<br>单位可选项如下图：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/187105/1557153024523-ad0d6616-acce-405a-84ec-5ba91e0f02ee.png#align=left&amp;display=inline&amp;height=372&amp;name=image.png&amp;originHeight=744&amp;originWidth=468&amp;size=60540&amp;status=done&amp;width=234" alt="image.png"><br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT ELAPSED(&lt;field_key&gt;, &lt;unit&gt;) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>示例：<br>计算h2o_feet字段在纳秒间隔下的差异。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT ELAPSED(water_level) FROM h2o_feet WHERE location = &apos;santa_monica&apos; AND time &gt;= &apos;2015-08-18T00:00:00Z&apos; and time &lt;= &apos;2015-08-18T00:24:00Z&apos;</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                            elapsed</span><br><span class="line">2015-08-18T00:06:00Z      360000000000</span><br><span class="line">2015-08-18T00:12:00Z      360000000000</span><br><span class="line">2015-08-18T00:18:00Z      360000000000</span><br><span class="line">2015-08-18T00:24:00Z      360000000000</span><br></pre></td></tr></table></figure><p></p><p>在一分钟间隔下的差异率</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT ELAPSED(water_level,1m) FROM h2o_feet WHERE location = &apos;santa_monica&apos; AND time &gt;= &apos;2015-08-18T00:00:00Z&apos; and time &lt;= &apos;2015-08-18T00:24:00Z&apos;</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                            elapsed</span><br><span class="line">2015-08-18T00:06:00Z      6</span><br><span class="line">2015-08-18T00:12:00Z      6</span><br><span class="line">2015-08-18T00:18:00Z      6</span><br><span class="line">2015-08-18T00:24:00Z      6</span><br></pre></td></tr></table></figure><p>注意：如果设置的时间间隔比字段数据间的时间间隔更大时，则函数会返回0，如下所示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT ELAPSED(water_level,1h) FROM h2o_feet WHERE location = &apos;santa_monica&apos; AND time &gt;= &apos;2015-08-18T00:00:00Z&apos; and time &lt;= &apos;2015-08-18T00:24:00Z&apos;</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                            elapsed</span><br><span class="line">2015-08-18T00:06:00Z      0</span><br><span class="line">2015-08-18T00:12:00Z      0</span><br><span class="line">2015-08-18T00:18:00Z      0</span><br><span class="line">2015-08-18T00:24:00Z      0</span><br></pre></td></tr></table></figure><ul><li><strong>MOVING_AVERAGE()函数</strong></li></ul><p>作用：返回一个连续字段值的移动平均值，字段类型必须是长整形或者float64类型。<br>语法：<br>基本语法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT MOVING_AVERAGE(&lt;field_key&gt;,&lt;window&gt;) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>与其他函数和GROUP BY time()语句一起使用时的语法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT MOVING_AVERAGE(&lt;function&gt;(&lt;field_key&gt;),&lt;window&gt;) FROM &lt;measurement_name&gt; WHERE &lt;stuff&gt; GROUP BY time(&lt;time_interval&gt;)</span><br></pre></td></tr></table></figure><p>此函数可以和以下函数一起使用：<br>COUNT(), MEAN(),MEDIAN(), SUM(), FIRST(), LAST(), MIN(), MAX(), and PERCENTILE().<br>示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT water_level FROM h2o_feet WHERE location = &apos;santa_monica&apos; AND time &gt;= &apos;2015-08-18T00:00:00Z&apos; and time &lt;= &apos;2015-08-18T00:36:00Z&apos;</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                            water_level</span><br><span class="line">2015-08-18T00:00:00Z      2.064</span><br><span class="line">2015-08-18T00:06:00Z      2.116</span><br><span class="line">2015-08-18T00:12:00Z      2.028</span><br><span class="line">2015-08-18T00:18:00Z      2.126</span><br><span class="line">2015-08-18T00:24:00Z      2.041</span><br><span class="line">2015-08-18T00:30:00Z      2.051</span><br><span class="line">2015-08-18T00:36:00Z      2.067</span><br></pre></td></tr></table></figure><ul><li><strong>NON_NEGATIVE_DERIVATIVE()函数</strong></li></ul><p>作用：返回在一个series中的一个字段中值的变化的非负速率。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT NON_NEGATIVE_DERIVATIVE(&lt;field_key&gt;, [&lt;unit&gt;]) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>其中unit取值可以为以下几个：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/187105/1557153263507-1161b8ba-ea9a-4c34-a8bd-940beda416e3.png#align=left&amp;display=inline&amp;height=186&amp;name=image.png&amp;originHeight=372&amp;originWidth=492&amp;size=50988&amp;status=done&amp;width=246" alt="image.png"><br>与聚合函数一块使用的语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT NON_NEGATIVE_DERIVATIVE(AGGREGATION_FUNCTION(&lt;field_key&gt;),[&lt;unit&gt;]) FROM &lt;measurement_name&gt; WHERE &lt;stuff&gt; GROUP BY time(&lt;aggregation_interval&gt;)</span><br></pre></td></tr></table></figure><ul><li><strong>STDDEV()函数</strong></li></ul><p>作用：返回一个字段中的值的标准偏差。值的类型必须是长整型或float64类型。<br>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT STDDEV(&lt;field_key&gt;) FROM &lt;measurement_name&gt; [WHERE &lt;stuff&gt;] [GROUP BY &lt;stuff&gt;]</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT STDDEV(water_level) FROM h2o_feet</span><br><span class="line">name: h2o_feet</span><br><span class="line">--------------</span><br><span class="line">time                           stddev</span><br><span class="line">1970-01-01T00:00:00Z     2.279144584196145</span><br></pre></td></tr></table></figure><p>示例2：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT STDDEV(water_level) FROM h2o_feet WHERE time &gt;= &apos;2015-08-18T00:00:00Z&apos; and time &lt; &apos;2015-09-18T12:06:00Z&apos; GROUP BY time(1w), location</span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location = coyote_creek</span><br><span class="line">time                           stddev</span><br><span class="line">----                           ------</span><br><span class="line">2015-08-13T00:00:00Z     2.2437263080193985</span><br><span class="line">2015-08-20T00:00:00Z     2.121276150144719</span><br><span class="line">2015-08-27T00:00:00Z     3.0416122170786215</span><br><span class="line">2015-09-03T00:00:00Z     2.5348065025435207</span><br><span class="line">2015-09-10T00:00:00Z     2.584003954882673</span><br><span class="line">2015-09-17T00:00:00Z     2.2587514836274414</span><br><span class="line"></span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location = santa_monica</span><br><span class="line">time                           stddev</span><br><span class="line">----                           ------</span><br><span class="line">2015-08-13T00:00:00Z     1.11156344587553</span><br><span class="line">2015-08-20T00:00:00Z     1.0909849279082366</span><br><span class="line">2015-08-27T00:00:00Z     1.9870116180096962</span><br><span class="line">2015-09-03T00:00:00Z     1.3516778450902067</span><br><span class="line">2015-09-10T00:00:00Z     1.4960573811500588</span><br><span class="line">2015-09-17T00:00:00Z     1.075701669442093</span><br></pre></td></tr></table></figure><p><a name="hDCT3"></a></p><h2 id="四、API库操作"><a href="#四、API库操作" class="headerlink" title="四、API库操作"></a>四、API库操作</h2><p><a name="tMJrZ"></a></p><h3 id="4-1-安装node的API包"><a href="#4-1-安装node的API包" class="headerlink" title="4.1 安装node的API包"></a>4.1 安装node的API包</h3><p>通过influx包，操作InfluxDB。<br>地址：<a href="https://www.npmjs.com/package/influx" target="_blank" rel="noopener">https://www.npmjs.com/package/influx</a><br><a name="P5UVO"></a></p><h3 id="4-2-新增database"><a href="#4-2-新增database" class="headerlink" title="4.2 新增database"></a>4.2 新增database</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> influx = <span class="keyword">new</span> Influx.InfluxDB(&#123;<span class="attr">host</span>: <span class="string">'localhost'</span>&#125;);</span><br><span class="line"><span class="keyword">await</span> influx.createDatabase(<span class="string">'helloworld'</span>);</span><br></pre></td></tr></table></figure><p><a name="MlISg"></a></p><h3 id="4-3-删除database"><a href="#4-3-删除database" class="headerlink" title="4.3 删除database"></a>4.3 删除database</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> influx = <span class="keyword">new</span> Influx.InfluxDB(&#123;<span class="attr">host</span>: <span class="string">'localhost'</span>&#125;);</span><br><span class="line"><span class="keyword">await</span> influx.dropDatabase(<span class="string">'helloworld'</span>);</span><br></pre></td></tr></table></figure><p><a name="gNP8B"></a></p><h3 id="4-4-判断是否存在database"><a href="#4-4-判断是否存在database" class="headerlink" title="4.4 判断是否存在database"></a>4.4 判断是否存在database</h3><p>下面的代码，判断如果不存在则取创建这个database<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> influx = <span class="keyword">new</span> Influx.InfluxDB(&#123;<span class="attr">host</span>: <span class="string">'localhost'</span>&#125;);</span><br><span class="line"><span class="keyword">if</span>((<span class="keyword">await</span> influx.getDatabaseNames()).filter(<span class="function"><span class="params">value</span>=&gt;</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> value === <span class="string">'helloworld'</span>;</span><br><span class="line">&#125;).length === <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="keyword">await</span> influx.createDatabase(<span class="string">'helloworld'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><a name="0XF6f"></a></p><h3 id="4-5-插入measurement数据"><a href="#4-5-插入measurement数据" class="headerlink" title="4.5 插入measurement数据"></a>4.5 插入measurement数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> influx2 = <span class="keyword">new</span> Influx.InfluxDB(&#123;<span class="attr">host</span>: <span class="string">'localhost'</span>, <span class="attr">database</span>: <span class="string">'helloworld'</span>&#125;);</span><br><span class="line"><span class="keyword">await</span> influx2.writeMeasurement(<span class="string">'hello'</span>, [&#123;</span><br><span class="line">  tags: &#123;<span class="attr">host</span>: <span class="string">'box1.example.com'</span>&#125;,</span><br><span class="line">  fields: &#123;<span class="attr">cpu</span>: <span class="number">123</span>, <span class="attr">mem</span>: <span class="number">234</span>&#125;</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure><p><a name="BTpKH"></a></p><h3 id="4-6-查询measurement数据"><a href="#4-6-查询measurement数据" class="headerlink" title="4.6 查询measurement数据"></a>4.6 查询measurement数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rows = <span class="keyword">await</span> influx2.query(<span class="string">`select * from response_times where host=<span class="subst">$&#123;Influx.<span class="built_in">escape</span>.stringLit(os.hostname())&#125;</span> order by time desc limit 10`</span>)</span><br><span class="line">rows.forEach(<span class="function"><span class="params">row</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`A request to <span class="subst">$&#123;row.cpu&#125;</span> took <span class="subst">$&#123;row.mem&#125;</span>ms`</span>))</span><br></pre></td></tr></table></figure><p><a name="rkSWO"></a></p><h2 id="五、数据备份和恢复"><a href="#五、数据备份和恢复" class="headerlink" title="五、数据备份和恢复"></a>五、数据备份和恢复</h2><p>InfluxDB提供了数据的备份和恢复方法，在实际工作中，可以通过这些方法来实现数据的高可用。<br><a name="fL7ql"></a></p><h3 id="5-1-数据备份"><a href="#5-1-数据备份" class="headerlink" title="5.1 数据备份"></a>5.1 数据备份</h3><p><a name="ynxzh"></a></p><h4 id="5-1-1-备份元数据"><a href="#5-1-1-备份元数据" class="headerlink" title="5.1.1 备份元数据"></a>5.1.1 备份元数据</h4><p>influxDB本地备份元数据的语法如下，这只会备份InfluxDB的的internal库数据，包含那些最基本的系统信息、用户信息等。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">influxd backup &lt;path-to-backup&gt;</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">influxd backup /tmp/backup</span><br><span class="line">2016/02/01 17:15:03 backing up metastore to /tmp/backup/meta.00</span><br><span class="line">2016/02/01 17:15:03 backup complete</span><br></pre></td></tr></table></figure><p><a name="K7ui4"></a></p><h4 id="5-1-2-备份数据库"><a href="#5-1-2-备份数据库" class="headerlink" title="5.1.2 备份数据库"></a>5.1.2 备份数据库</h4><p>可以通过 -database 参数来指定备份的数据库。<br>语法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">influxd backup -database &lt;mydatabase&gt; &lt;path-to-backup&gt;</span><br></pre></td></tr></table></figure><p>其他可选的参数:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-retention &lt;retention policy name&gt;</span><br><span class="line">-shard &lt;shard ID&gt;</span><br><span class="line">-since &lt;date&gt;</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">influxd backup -database telegraf -retention autogen -since 2016-02-01T00:00:00Z /tmp/backup</span><br><span class="line">2016/02/01 18:02:36 backing up rp=default since 2016-02-01 00:00:00 +0000 UTC</span><br><span class="line">2016/02/01 18:02:36 backing up metastore to /tmp/backup/meta.01</span><br><span class="line">2016/02/01 18:02:36 backing up db=telegraf rp=default shard=2 to /tmp/backup/telegraf.default.00002.01 since 2016-02-01 00:00:00 +0000 UTC</span><br><span class="line">2016/02/01 18:02:36 backup complete</span><br></pre></td></tr></table></figure><p><a name="iCZR2"></a></p><h4 id="5-1-4-远程备份"><a href="#5-1-4-远程备份" class="headerlink" title="5.1.4 远程备份"></a>5.1.4 远程备份</h4><p>InfluxDB可以使用 -host 参数实现数据的远程备份，端口一般是8088</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">influxd backup -database mydatabase -host 10.0.0.1:8088 /tmp/mysnapshot</span><br></pre></td></tr></table></figure><p><a name="J7Mcz"></a></p><h3 id="5-2-数据恢复"><a href="#5-2-数据恢复" class="headerlink" title="5.2 数据恢复"></a>5.2 数据恢复</h3><p>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">influxd restore [ -metadir | -datadir ] &lt;path-to-meta-or-data-directory&gt; &lt;path-to-backup&gt;</span><br></pre></td></tr></table></figure><p>必要参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-metadir &lt;path-to-meta-directory&gt;</span><br><span class="line">或</span><br><span class="line">-datadir &lt;path-to-data-directory&gt;</span><br></pre></td></tr></table></figure><p>可选参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-database &lt;database&gt;</span><br><span class="line">-retention &lt;retention policy&gt;</span><br><span class="line">-shard &lt;shard id&gt;</span><br></pre></td></tr></table></figure><p>示例，恢复数据库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ influxd restore -database telegraf -datadir /var/lib/influxdb/data /tmp/backup                                                                         </span><br><span class="line">Restoring from backup /tmp/backup/telegraf.*</span><br><span class="line">unpacking /var/lib/influxdb/data/telegraf/default/2/000000004-000000003.tsm</span><br><span class="line">unpacking /var/lib/influxdb/data/telegraf/default/2/000000005-000000001.tsm</span><br></pre></td></tr></table></figure><p><a name="2FsTi"></a></p><h2 id="五、原理篇"><a href="#五、原理篇" class="headerlink" title="五、原理篇"></a>五、原理篇</h2><p>这块研究的时候，可以看一下网易大神：范欣欣的文章<br><a href="http://hbasefly.com/category/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93/" target="_blank" rel="noopener">http://hbasefly.com/category/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93/</a><br><a name="7iGlp"></a></p><h2 id="六、账号体系"><a href="#六、账号体系" class="headerlink" title="六、账号体系"></a>六、账号体系</h2><p><a name="jdzBF"></a></p><h3 id="6-1-查看账号"><a href="#6-1-查看账号" class="headerlink" title="6.1 查看账号"></a>6.1 查看账号</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show users</span><br></pre></td></tr></table></figure><p><a name="PrK7D"></a></p><h3 id="6-2-新建账号"><a href="#6-2-新建账号" class="headerlink" title="6.2 新建账号"></a>6.2 新建账号</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create user “username” with password ‘password’</span><br></pre></td></tr></table></figure><p>此处注意，password必须用单引号引起来。<br><a name="a3jJq"></a></p><h3 id="6-3-新建含有权限的账号"><a href="#6-3-新建含有权限的账号" class="headerlink" title="6.3 新建含有权限的账号"></a>6.3 新建含有权限的账号</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create user “username” with password ‘password’ with all privileges</span><br></pre></td></tr></table></figure><p><a name="QhrqL"></a></p><h3 id="6-4-修改用户密码"><a href="#6-4-修改用户密码" class="headerlink" title="6.4 修改用户密码"></a>6.4 修改用户密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET PASSWORD FOR admin =’influx@gpscloud’</span><br></pre></td></tr></table></figure><p><a name="mIyRQ"></a></p><h3 id="6-5-删除用户"><a href="#6-5-删除用户" class="headerlink" title="6.5 删除用户"></a>6.5 删除用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop user ‘username’ 删除用户</span><br></pre></td></tr></table></figure><p><a name="mI20p"></a></p><h2 id="七、常用问题篇"><a href="#七、常用问题篇" class="headerlink" title="七、常用问题篇"></a>七、常用问题篇</h2><p><a name="ymCTJ"></a></p><h3 id="7-1-集群搭建方式"><a href="#7-1-集群搭建方式" class="headerlink" title="7.1 集群搭建方式"></a>7.1 集群搭建方式</h3><p>官方的集群方案是收费的，但是由于influxDB是开源的，所以应该会有人做出来开源集群模式。</p><p><a name="R3JaQ"></a></p><h3 id="7-2-UI-无法连接的问题"><a href="#7-2-UI-无法连接的问题" class="headerlink" title="7.2 UI 无法连接的问题"></a>7.2 UI 无法连接的问题</h3><p>InfluxDB在0.13版本以后，就默认关闭了web管理页面。如果是0.13版本到1.1版本之间的版本，我们可以通过修改配置文件：<br><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/187105/1557153763170-0db6923e-1638-45e1-98e4-3030f36f453c.jpeg#align=left&amp;display=inline&amp;height=274&amp;originHeight=274&amp;originWidth=614&amp;size=0&amp;status=done&amp;width=614" alt=""><br>将enabled改为true并把注释删除。然后https看应用场景。<br>但是如果使用的是1.1版本之后的，则没有web管理界面了。<br>版本如何查看，我们可以使用客户端软件 influx –version就能看到。</p><p><a name="M18mb"></a></p><h3 id="7-3-单机InfluxDB能支撑多大"><a href="#7-3-单机InfluxDB能支撑多大" class="headerlink" title="7.3 单机InfluxDB能支撑多大"></a>7.3 单机InfluxDB能支撑多大</h3><p>我们查看API，他可以批量插入和非批量插入。以下测试在自己电脑上进行测试，得出结论基本是数字的差别，规律是相同的。</p><p><a name="eAgLh"></a></p><h4 id="7-3-1-批量插入："><a href="#7-3-1-批量插入：" class="headerlink" title="7.3.1 批量插入："></a>7.3.1 批量插入：</h4><p>以下数据测试方法: 10次以下结果的平均。平均看到的情况，在5万附近，并不会随着数据量的增长，而出现明显的增长</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1次1万条, 花费了151ms, 平均下来一秒插入66050条数据</span><br><span class="line">1次2万条, 花费了342ms, 平均下来一秒插入58462条数据</span><br><span class="line">1次3万条, 花费了652ms, 平均下来一秒插入46005条数据</span><br><span class="line">1次4万条, 花费了766ms, 平均下来一秒插入52192条数据</span><br><span class="line">1次5万条, 花费了882ms, 平均下来一秒插入56637条数据</span><br><span class="line">1次6万条, 花费了1185ms, 平均下来一秒插入50603条数据</span><br><span class="line">1次7万条, 花费了1277ms, 平均下来一秒插入54807条数据</span><br><span class="line">1次8万条, 花费了1472ms, 平均下来一秒插入54336条数据</span><br><span class="line">1次9万条, 花费了1597ms, 平均下来一秒插入56330条数据</span><br><span class="line">1次10万条, 花费了1764ms, 平均下来一秒插入56663条数据</span><br><span class="line">1次11万条, 花费了2181ms, 平均下来一秒插入50421条数据</span><br><span class="line">1次12万条, 花费了2494ms, 平均下来一秒插入48107条数据</span><br><span class="line">1次13万条, 花费了2642ms, 平均下来一秒插入49197条数据</span><br><span class="line">1次14万条, 花费了2825ms, 平均下来一秒插入49557条数据</span><br><span class="line">1次15万条以上，测试过程中会报错，所以单次插入量不能太大。先会出现Internal Server Error的情况</span><br><span class="line">再往上增长，则会出现Request Entity Too Large.</span><br></pre></td></tr></table></figure><p>所以批量插入的情况来看，量能承受比较大。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Influx = <span class="built_in">require</span>(<span class="string">'influx'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = []</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> influx = <span class="keyword">new</span> Influx.InfluxDB(&#123;<span class="attr">host</span>: <span class="string">'localhost'</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">await</span> influx.getDatabaseNames()).filter(<span class="function"><span class="params">value</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value === <span class="string">'helloworld'</span>;</span><br><span class="line">    &#125;).length !== <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">await</span> influx.dropDatabase(<span class="string">'helloworld'</span>)</span><br><span class="line">        <span class="keyword">await</span> influx.createDatabase(<span class="string">'helloworld'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> influx2 = <span class="keyword">new</span> Influx.InfluxDB(&#123;<span class="attr">host</span>: <span class="string">'localhost'</span>, <span class="attr">database</span>: <span class="string">'helloworld'</span>&#125;);</span><br><span class="line">    <span class="keyword">let</span> startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="keyword">let</span> data = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; num * <span class="number">10000</span>; i++)&#123;</span><br><span class="line">        data.push(&#123;</span><br><span class="line">            measurement: <span class="string">'hello'</span>,</span><br><span class="line">            tags: &#123;<span class="attr">host</span>: <span class="string">'box'</span> + i + <span class="string">'.example.com'</span>&#125;,</span><br><span class="line">            fields: &#123;<span class="attr">cpu</span>: <span class="number">123</span>, <span class="attr">mem</span>: <span class="number">234</span>&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> influx2.writePoints(data);</span><br><span class="line">    <span class="keyword">const</span> useTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - startTime;</span><br><span class="line">    <span class="keyword">if</span>(result.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.num;</span><br><span class="line">    &#125;).filter(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value === num;</span><br><span class="line">    &#125;).length === <span class="number">0</span>)&#123;</span><br><span class="line">        result.push(&#123;</span><br><span class="line">            num: num,</span><br><span class="line">            useTime: [useTime]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        result.filter(<span class="function"><span class="params">value</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> value.num === num;</span><br><span class="line">        &#125;)[<span class="number">0</span>].useTime.push(useTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">boostrap</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">15</span>; j++)&#123;</span><br><span class="line">            <span class="keyword">await</span> write(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    result.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> useTime = item.useTime.reduce(<span class="function">(<span class="params">previous, current</span>)=&gt;</span>&#123;<span class="keyword">return</span> previous + current&#125;, <span class="number">0</span>)/item.useTime.length</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'1次'</span> + item.num + <span class="string">'万条, 花费了'</span> + <span class="built_in">parseInt</span>(useTime) + <span class="string">"ms, 平均下来一秒插入"</span> + <span class="built_in">parseInt</span>(item.num * <span class="number">10000</span>/useTime*<span class="number">1000</span>) +<span class="string">"条数据"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">boostrap();</span><br></pre></td></tr></table></figure><p><a name="1bvIk"></a></p><h4 id="7-3-2-非批量插入"><a href="#7-3-2-非批量插入" class="headerlink" title="7.3.2 非批量插入"></a>7.3.2 非批量插入</h4><p>非批量操作，简称，每次插入一条数据。那这种肯定是会比较慢的。应用场景：比如应用连接了对应的influxDB，然后来一条数据插入一条。<br>以下是测试代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Influx = <span class="built_in">require</span>(<span class="string">'influx'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = []</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> influx = <span class="keyword">new</span> Influx.InfluxDB(&#123;<span class="attr">host</span>: <span class="string">'localhost'</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">await</span> influx.getDatabaseNames()).filter(<span class="function"><span class="params">value</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value === <span class="string">'helloworld'</span>;</span><br><span class="line">    &#125;).length !== <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">await</span> influx.dropDatabase(<span class="string">'helloworld'</span>)</span><br><span class="line">        <span class="keyword">await</span> influx.createDatabase(<span class="string">'helloworld'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> influx2 = <span class="keyword">new</span> Influx.InfluxDB(&#123;<span class="attr">host</span>: <span class="string">'localhost'</span>, <span class="attr">database</span>: <span class="string">'helloworld'</span>&#125;);</span><br><span class="line">    <span class="keyword">let</span> startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; num * <span class="number">100</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">await</span> influx2.writePoints([&#123;</span><br><span class="line">            measurement: <span class="string">'hello'</span>,</span><br><span class="line">            tags: &#123;<span class="attr">host</span>: <span class="string">'box'</span> + i + <span class="string">'.example.com'</span>&#125;,</span><br><span class="line">            fields: &#123;<span class="attr">cpu</span>: <span class="number">123</span>, <span class="attr">mem</span>: <span class="number">234</span>&#125;</span><br><span class="line">        &#125;]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> useTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - startTime;</span><br><span class="line">    <span class="keyword">if</span>(result.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.num;</span><br><span class="line">    &#125;).filter(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value === num;</span><br><span class="line">    &#125;).length === <span class="number">0</span>)&#123;</span><br><span class="line">        result.push(&#123;</span><br><span class="line">            num: num,</span><br><span class="line">            useTime: [useTime]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        result.filter(<span class="function"><span class="params">value</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> value.num === num;</span><br><span class="line">        &#125;)[<span class="number">0</span>].useTime.push(useTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">boostrap</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">15</span>; j++)&#123;</span><br><span class="line">            <span class="keyword">await</span> write(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    result.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> useTime = item.useTime.reduce(<span class="function">(<span class="params">previous, current</span>)=&gt;</span>&#123;<span class="keyword">return</span> previous + current&#125;, <span class="number">0</span>)/item.useTime.length</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'1次'</span> + item.num*<span class="number">100</span> + <span class="string">'条, 花费了'</span> + <span class="built_in">parseInt</span>(useTime) + <span class="string">"ms, 平均下来一秒插入"</span> + <span class="built_in">parseInt</span>(item.num * <span class="number">100</span>/useTime*<span class="number">1000</span>) +<span class="string">"条数据"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">boostrap();</span><br></pre></td></tr></table></figure><p>数据结果：<br>测试结果，均是10次的平均值，还是比较准确反映了当前的性能的。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">100条, 花费了771ms, 平均下来一秒插入129条数据</span><br><span class="line">200条, 花费了1692ms, 平均下来一秒插入118条数据</span><br><span class="line">300条, 花费了2319ms, 平均下来一秒插入129条数据</span><br><span class="line">400条, 花费了2994ms, 平均下来一秒插入133条数据</span><br><span class="line">500条, 花费了3776ms, 平均下来一秒插入132条数据</span><br><span class="line">600条, 花费了4788ms, 平均下来一秒插入125条数据</span><br><span class="line">700条, 花费了5250ms, 平均下来一秒插入133条数据</span><br><span class="line">800条, 花费了5973ms, 平均下来一秒插入133条数据</span><br><span class="line">900条, 花费了6765ms, 平均下来一秒插入133条数据</span><br><span class="line">1000条, 花费了7491ms, 平均下来一秒插入133条数据</span><br><span class="line">1100条, 花费了8161ms, 平均下来一秒插入134条数据</span><br><span class="line">1200条, 花费了8733ms, 平均下来一秒插入137条数据</span><br><span class="line">1300条, 花费了9492ms, 平均下来一秒插入136条数据</span><br><span class="line">1400条, 花费了10373ms, 平均下来一秒插入134条数据</span><br></pre></td></tr></table></figure><p></p><p><a name="QJU9u"></a></p><h4 id="7-3-3-存储数据"><a href="#7-3-3-存储数据" class="headerlink" title="7.3.3 存储数据"></a>7.3.3 存储数据</h4><p>我们通过查看du -sh /var/lib/influxdb/data/helloworld，最后这个helloworld也就是对应database的名字。<br>数据情况:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1万条：504k</span><br><span class="line">2万条：956k</span><br><span class="line">3万条：1.4M</span><br><span class="line">4万条：1.9M</span><br><span class="line">5万条：2.3M</span><br><span class="line">6万条：2.7M</span><br><span class="line">7万条：3.2M</span><br><span class="line">8万条：3.6M</span><br><span class="line">9万条：4.1M</span><br><span class="line">10万条：4.5M</span><br><span class="line">11万条：4.9M</span><br><span class="line">12万条：5.4M</span><br><span class="line">13万条：5.8M</span><br><span class="line">14万条：6.3M</span><br><span class="line">15万条：6.7M</span><br></pre></td></tr></table></figure><p>这个数据大小，一个point数据的大小有关，比如当前一条数据：<br>其中host字段是tag，而cpu和mem是fields，所以关于数据量的估量，也是监控系统需要考虑的问题。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/187105/1557235302652-ee68b662-41ef-4aed-b22f-66a077d4fe72.png#align=left&amp;display=inline&amp;height=81&amp;name=image.png&amp;originHeight=81&amp;originWidth=380&amp;size=7928&amp;status=done&amp;width=380" alt="image.png"><br><a name="D9N0N"></a></p><h4 id="7-3-4-读的性能"><a href="#7-3-4-读的性能" class="headerlink" title="7.3.4 读的性能"></a>7.3.4 读的性能</h4><p>为什么要测试读的性能，我们会在Grafana上面配置很多图表，如果数据源是InfluxDB的话，一个图表意味着1~N次请求，那么一个dashboard其实是有好多请求。这个时候，如果有很多个人在看自己的Dashboard的话，那么对于InfluxDB的压力还是比较大的。<br>测试代码：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Influx = <span class="built_in">require</span>(<span class="string">'influx'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = []</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> influx = <span class="keyword">new</span> Influx.InfluxDB(&#123;<span class="attr">host</span>: <span class="string">'localhost'</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">await</span> influx.getDatabaseNames()).filter(<span class="function"><span class="params">value</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value === <span class="string">'helloworld'</span>;</span><br><span class="line">    &#125;).length !== <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">await</span> influx.dropDatabase(<span class="string">'helloworld'</span>)</span><br><span class="line">        <span class="keyword">await</span> influx.createDatabase(<span class="string">'helloworld'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="keyword">let</span> data = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; num * <span class="number">10000</span>; i++)&#123;</span><br><span class="line">        data.push(&#123;</span><br><span class="line">            measurement: <span class="string">'hello'</span>,</span><br><span class="line">            tags: &#123;<span class="attr">host</span>: <span class="string">'box'</span> + i + <span class="string">'.example.com'</span>&#125;,</span><br><span class="line">            fields: &#123;<span class="attr">cpu</span>: <span class="number">123</span>, <span class="attr">mem</span>: <span class="number">234</span>&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> influx2.writePoints(data);</span><br><span class="line">    <span class="keyword">const</span> useTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - startTime;</span><br><span class="line">    <span class="keyword">if</span>(result.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item.num;</span><br><span class="line">    &#125;).filter(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value === num;</span><br><span class="line">    &#125;).length === <span class="number">0</span>)&#123;</span><br><span class="line">        result.push(&#123;</span><br><span class="line">            num: num,</span><br><span class="line">            useTime: [useTime]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        result.filter(<span class="function"><span class="params">value</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> value.num === num;</span><br><span class="line">        &#125;)[<span class="number">0</span>].useTime.push(useTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">boostrap</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> influx2 = <span class="keyword">new</span> Influx.InfluxDB(&#123;<span class="attr">host</span>: <span class="string">'localhost'</span>, <span class="attr">database</span>: <span class="string">'helloworld'</span>&#125;);</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">1</span>; j &lt; <span class="number">15</span>; j++)&#123;</span><br><span class="line">            <span class="keyword">let</span> startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> z = <span class="number">0</span>; z &lt; <span class="number">1</span>*j; z++)&#123;</span><br><span class="line">                <span class="keyword">await</span> influx2.query(<span class="string">`select count(mem) from hello limit 10000`</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> endTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">            <span class="keyword">if</span>(result.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> item.num;</span><br><span class="line">            &#125;).filter(<span class="function"><span class="params">value</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> value === <span class="number">1</span> *j</span><br><span class="line">            &#125;).length === <span class="number">0</span>)&#123;</span><br><span class="line">                result.push(&#123;</span><br><span class="line">                    num: <span class="number">1</span>*j,</span><br><span class="line">                    useTime: [endTime-startTime]</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                result.filter(<span class="function"><span class="params">value</span>=&gt;</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> value.num === <span class="number">1</span>*j</span><br><span class="line">                &#125;)[<span class="number">0</span>].useTime.push(endTime-startTime)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"====&gt;"</span> + j)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    result.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'一共'</span> + item.num + <span class="string">"次查询, 平均花费"</span> + <span class="built_in">parseInt</span>(item.useTime.reduce(<span class="function">(<span class="params">a,b</span>)=&gt;</span>a+b, <span class="number">0</span>)/item.num/item.useTime.length) + <span class="string">"ms"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">boostrap();</span><br></pre></td></tr></table></figure><p></p><p>结论数据：<br>在15万的数据表中，进行查询count的操作。select count(mem) from hello limit 10000<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">一共1次查询, 平均花费200ms</span><br><span class="line">一共2次查询, 平均花费315ms</span><br><span class="line">一共3次查询, 平均花费171ms</span><br><span class="line">一共4次查询, 平均花费143ms</span><br><span class="line">一共5次查询, 平均花费169ms</span><br><span class="line">一共6次查询, 平均花费139ms</span><br><span class="line">一共7次查询, 平均花费155ms</span><br><span class="line">一共8次查询, 平均花费166ms</span><br><span class="line">一共9次查询, 平均花费147ms</span><br><span class="line">一共10次查询, 平均花费188ms</span><br><span class="line">一共11次查询, 平均花费162ms</span><br><span class="line">一共12次查询, 平均花费246ms</span><br><span class="line">一共13次查询, 平均花费141ms</span><br><span class="line">一共14次查询, 平均花费160ms</span><br></pre></td></tr></table></figure><p></p><p>然后得出上面的结论，说明当数据量比较大的时候，查询一次操作，需要花费的时间还是蛮大的。<br>所以这块如何提升性能，还是比较重要的。不然图表多了，那必然响应不过来了。<br>15w数据量是多大的数据量：假设我们5秒一条数据，1天的量：12 <em>60 </em>24=17280，差不多一天2万的量，也就是有一周的数据量。<br>当我们在一个一周数据量的数据里面，捞我们想要的数据，假如一个grafana的dashboard是10个图表，假设10个接口，那按照上面的算法，毛估估还是要花费比较长时间的。<br>然后用ab测试了一下性能：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -n 20 -c 5 -H &quot;Cookie: email=hzjinbing%40163.com; username=jinbing; grafana_session=af2db0101608c095d7ea7b55e7bc0ddb&quot; http://127.0.0.1:32768/api/datasources/proxy/6/query\?db\=helloworld\&amp;q\=SELECT%20count\(%22mem%22\)%20FROM%20%22hello%22%20WHERE%20time%20%3E%3D%20now\(\)%20-%206h%20GROUP%20BY%20time\(20s\)%20fill\(null\)\&amp;epoch\=ms</span><br></pre></td></tr></table></figure><p>此处我拿了一个grafana图表的接口进行压测。<br>效果：大概每秒只能处理两个请求，说明，真实的时候，当量大了之后，确实这个反应应该如何处理，否则grafana去InfluxDB数据源去展示的时候，人多了完全不能看呀。<br><a name="oe4XK"></a></p><h4 id="7-3-5-结论"><a href="#7-3-5-结论" class="headerlink" title="7.3.5 结论"></a>7.3.5 结论</h4><p>如果在单机的情况下，我们可以做对应的数据聚合层，然后将数据聚合然后再存储到对应的influxDB。</p><ol><li>减少了跟InfluxDB的连接数量</li><li>单次插入一条的性能，要远远小于单次批量插入多条的性能。</li></ol><p>这块，influxdb-relay 是官方提供的高可用方案，但是它只提供简单的写入功能。初期使用问题不大，因为对于写的问题暴露的不明显，但是随着业务方的增长，对于读这块的请求比较大的时候，又会引起InfluxDB的性能瓶颈。</p><h2 id="八、参考文档"><a href="#八、参考文档" class="headerlink" title="八、参考文档"></a>八、参考文档</h2><ol><li>influxDB系列教程 <a href="https://www.linuxdaxue.com/how-to-install-influxdb.html" target="_blank" rel="noopener">https://www.linuxdaxue.com/how-to-install-influxdb.html</a></li><li>influxDB原理：<a href="http://hbasefly.com/category/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93/" target="_blank" rel="noopener">http://hbasefly.com/category/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93/</a></li></ol><div class="post-announce">感谢您的阅读，本文由 <a href="http://blog.fedfans.com">大米小米的博客</a> 版权所有。<br>如若转载，请注明出处：大米小米的博客（<a href="http://blog.fedfans.com/page/article/influx时序数据库/">http://blog.fedfans.com/page/article/influx时序数据库/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/page/article/Angular_Ivy改变了变化检测机制,你准备好了吗/" title="Angular Ivy改变了变化检测机制，你准备好了吗?"><i class="iconfont icon-prev"></i>Angular Ivy改变了变化检测机制，你准备好了吗?</a></div><div class="post__prev post__prev--right"><a href="/page/article/严选Node对接携程Apollo配置中心/" title="严选Node对接携程Apollo配置中心">严选Node对接携程Apollo配置中心<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">日常学习与兴趣交流的个人博客</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/问题篇/">问题篇</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/解决方案/">解决方案</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/站点维护/">站点维护</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/环境搭建/">环境搭建</a><span class="block-list-count">3</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/服务器配置/">服务器配置</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/服务器/">服务器</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/日常杂记/">日常杂记</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/数据库/">数据库</a><span class="block-list-count">1</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/数据库/Influx/">Influx</a><span class="block-list-count">1</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/工程化/">工程化</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/后端/">后端</a><span class="block-list-count">6</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/后端/Node/">Node</a><span class="block-list-count">2</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/后端/Node/Koa/">Koa</a><span class="block-list-count">1</span></li></ul></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/">前端</a><span class="block-list-count">7</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/前端/Angular/">Angular</a><span class="block-list-count">6</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/Spring-Cloud/">Spring Cloud</a><span class="block-list-count">9</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/Pandora源码分析/">Pandora源码分析</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/Node/">Node</a><span class="block-list-count">1</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/page/article/严选Node对接携程Apollo配置中心/" title="严选Node对接携程Apollo配置中心"><div class="item__cover"><img src="https://cdn.nlark.com/yuque/0/2019/png/187105/1557386231926-fb7107ea-fbea-41fd-8e42-c334fbc68547.png" alt="严选Node对接携程Apollo配置中心"></div><div class="item__info"><h3 class="item__title">严选Node对接携程Apollo配置中心</h3><span class="item__text">2019-05-09</span></div></a></li><li class="latest-post-item"><a href="/page/article/influx时序数据库/" title="Influx时序数据库"><div class="item__cover"><img src="https://520stone-blog.oss-cn-beijing.aliyuncs.com/blog_fedfans/WX20190508-143057.png" alt="Influx时序数据库"></div><div class="item__info"><h3 class="item__title">Influx时序数据库</h3><span class="item__text">2019-05-07</span></div></a></li><li class="latest-post-item"><a href="/page/article/Angular_Ivy改变了变化检测机制,你准备好了吗/" title="Angular Ivy改变了变化检测机制，你准备好了吗?"><div class="item__cover"><img src="http://520stone-blog.oss-cn-beijing.aliyuncs.com/blog_fedfans/1_KrIqm7-40larFWM7SeU8wQ.png" alt="Angular Ivy改变了变化检测机制，你准备好了吗?"></div><div class="item__info"><h3 class="item__title">Angular Ivy改变了变化检测机制，你准备好了吗?</h3><span class="item__text">2018-10-28</span></div></a></li><li class="latest-post-item"><a href="/page/article/Angular在新版本中脏值检测机制发生了改变/" title="Angular在新版本中，脏值检测重生了《译》"><div class="item__cover"><img src="http://520stone-blog.oss-cn-beijing.aliyuncs.com/blog_fedfans/1_DEeCWAZ_UhN36xf4aY4EBg.jpeg" alt="Angular在新版本中，脏值检测重生了《译》"></div><div class="item__info"><h3 class="item__title">Angular在新版本中，脏值检测重生了《译》</h3><span class="item__text">2018-10-28</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/Angular/">Angular</a></li><li class="tag-item"><a class="tag-link" href="/tags/Apollo/">Apollo</a></li><li class="tag-item"><a class="tag-link" href="/tags/Gitlab/">Gitlab</a></li><li class="tag-item"><a class="tag-link" href="/tags/Influx/">Influx</a></li><li class="tag-item"><a class="tag-link" href="/tags/JAVA/">JAVA</a></li><li class="tag-item"><a class="tag-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-item"><a class="tag-link" href="/tags/MAVEN/">MAVEN</a></li><li class="tag-item"><a class="tag-link" href="/tags/Maven/">Maven</a></li><li class="tag-item"><a class="tag-link" href="/tags/Node/">Node</a></li><li class="tag-item"><a class="tag-link" href="/tags/NodeJS/">NodeJS</a></li><li class="tag-item"><a class="tag-link" href="/tags/NodeJs/">NodeJs</a></li><li class="tag-item"><a class="tag-link" href="/tags/Node监控/">Node监控</a></li><li class="tag-item"><a class="tag-link" href="/tags/Pandora/">Pandora</a></li><li class="tag-item"><a class="tag-link" href="/tags/Spring-Cloud/">Spring Cloud</a></li><li class="tag-item"><a class="tag-link" href="/tags/Swap/">Swap</a></li><li class="tag-item"><a class="tag-link" href="/tags/前端/">前端</a></li><li class="tag-item"><a class="tag-link" href="/tags/基建/">基建</a></li><li class="tag-item"><a class="tag-link" href="/tags/工程化/">工程化</a></li><li class="tag-item"><a class="tag-link" href="/tags/数据库/">数据库</a></li><li class="tag-item"><a class="tag-link" href="/tags/方案/">方案</a></li><li class="tag-item"><a class="tag-link" href="/tags/日志/">日志</a></li><li class="tag-item"><a class="tag-link" href="/tags/服务器/">服务器</a></li><li class="tag-item"><a class="tag-link" href="/tags/杂记/">杂记</a></li><li class="tag-item"><a class="tag-link" href="/tags/源码阅读/">源码阅读</a></li><li class="tag-item"><a class="tag-link" href="/tags/环境搭建/">环境搭建</a></li><li class="tag-item"><a class="tag-link" href="/tags/环境配置/">环境配置</a></li><li class="tag-item"><a class="tag-link" href="/tags/生活/">生活</a></li><li class="tag-item"><a class="tag-link" href="/tags/站点维护/">站点维护</a></li><li class="tag-item"><a class="tag-link" href="/tags/编译报错/">编译报错</a></li><li class="tag-item"><a class="tag-link" href="/tags/评论/">评论</a></li><li class="tag-item"><a class="tag-link" href="/tags/配置中心/">配置中心</a></li><li class="tag-item"><a class="tag-link" href="/tags/问题/">问题</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">本站是基于 Hexo 搭建的静态资源博客，主要用于分享日常学习、生活及工作的一些心得总结。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Hangzhou, ZheJiang Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>hzjinbing@163.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="https://user-images.githubusercontent.com/6525544/44786587-302e9180-abc7-11e8-9751-31499ac38a78.png" alt="logo" title="大米小米的博客"></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="http://spring4all.com/" title="Spring CLoud、Spring Boot等技术栈" target="_blank">Spring For All社区</a></li><li class="list-item"><a href="https://anoyi.com/" title="ANOYI 轻量级微服务架构" target="_blank">ANOYI 轻量级微服务架构</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog Framework" target="_blank">Hexo</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/stone-jin" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:hzjinbing@163.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["数据库","Influx"],gitalk=new Gitalk({clientID:"63d06125b339465f0bce",clientSecret:"12a9180d9606c445e08a9e176254e2cb5a18387b",repo:"hexo-blog",owner:"stone-jin",admin:["stone-jin"],labels:tags,id:new Date(15572421e5).getTime()>new Date("2018-02-15").getTime()?md5(location.href):location.href});gitalk.render("comment-container")</script><script>!function(t,h,e,j,s,n){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:1060458,hjsv:6},s=h.getElementsByTagName("head")[0],(n=h.createElement("script")).async=1,n.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,s.appendChild(n)}(window,document)</script></body></html>