---
title: (二) Spring Boot中使用Spring Security进行安全控制之中级订制
cover: https://img.zcool.cn/community/011e475b86a540a80120245c336724.jpg@1280w_1l_2o_100sh.jpg
subtitle: Spring Boot中使用Spring Security进行安全控制之中级订制
date: 2018-04-27 19:49:11
author: 
  nick: 金炳
  link: https://www.github.com/stone-jin
categories:
- Spring Cloud
tags:
- JAVA
- Spring Cloud
---

## 一、前奏
前面我们讲解了Spring Boot中如何去集成Spring Security进行简单的安全方面的权限控制，满足了我们的简单需求，比如管理后台中，我肯定是不希望所有人都能访问我的管理后台进行对数据的操作。通过简单的pom包引用和application.yml解决了我们的权限问题，实现了管理后台的简单的用户认证。

## 二、待改进的方面
我们其实从前面的文章中看到了，我们虽然在springboot中集成了Spring security解决了登录，但是这个界面是一个alert一样的模态框，那我们能否订制呢？还有这个能否登入登出呢？我们能否在登录的时候获取登录人的信息呢？application.yml中的用户和密码能否变成数据库里面的用户呢？

## 三、改进的办法
答案肯定是可以的。本章我们只先解决订制界面效果，以及获取用户的账号，并且实现登出的功能

我们在代码中需要配置SpringSecurity的adapter，来让框架知道登录的地址是哪个，然后放行是哪个。
```java
@Configuration
@EnableWebSecurity
public class WebSecurityConfig2 extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers("/home").permitAll()
                .anyRequest().authenticated()
                .and()
            .formLogin()
                .loginPage("/login")
                .defaultSuccessUrl("/hello")
                .permitAll()
                .and()
                .logout()
            .permitAll();
    }
}
```

这时候我们使用thymeleaf来开发对应的登录页面和登陆后的页面，这个时候我们编写登录后的代码和登录后的controller。

```java
@Controller
@Slf4j
@RequestMapping("")
public class IndexController {

    @RequestMapping("/login")
    public String hello(UserVO userVO,Model model ){
        model.addAttribute("user", userVO);
        log.info("hello");
        return "index2";
    }

    @RequestMapping("/hello")
    public String hello1(){
        return "index3";
    }
}
```

上面的代码里面/login会指向登录页面，hello指向登陆后的页面。

然后写完controller我们会编写对应的html页面如下：

index2.html(也就是登录页面）

```html
<!DOCTYPE html>
<html lang="zh-cn" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Login</title>
</head>

<body>
<div class="container">
    <h3 align="center">这是一个带有登录框的主页</h3>
    <form class="form-signin" th:action="@{/login}" th:object="${user}" method="post">
        <h2 class="form-signin-heading">请 登 录</h2>
        <input type="text" class="form-control" placeholder="账号" th:field="*{username}"/>
        <input type="password" class="form-control" placeholder="密码" th:field="*{password}"/>
        <button class="btn btn-lg btn-primary btn-block" type="submit">登录</button>
    </form>
</div>
</body>
</html>
```

index3.html（也就是登录后的页面）

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Hello World!</title>
</head>
<body>
<h1 th:inline="text">Hello [[${#httpServletRequest.remoteUser}]]!</h1>
<form th:action="@{/logout}" method="post">
    <input type="submit" value="注 销"/>
</form>
</body>
</html>
```

然后到此，登录登出的代码都写完了，然后我们来测试下效果：

登录页面：

![](https://520stone-blog.oss-cn-beijing.aliyuncs.com/upload/2018-04-28T02:04:14Z/71693e7e-777e-484c-8a52-016fdaefc6f8.png)

登录后的页面：

![](https://520stone-blog.oss-cn-beijing.aliyuncs.com/upload/2018-04-28T02:05:40Z/3bf41578-222c-45a2-93e7-c44eea28955e.png)

## 四、总结
至此，我们实现了以下功能：

1.Springboot结合Spring Security进行登录功能

2.实现了对登录功能的模态框进行了定制化开发，变成了我们自己的页面

3.实现了代码里面对应登录用户的用户名的显示

4.登出功能

代码放在github上：[https://github.com/stone-jin/spring-boot-security2](https://github.com/stone-jin/spring-boot-security2)

下面一节：

我们将介绍如何来实现这个用户不是这个配置里面的，而是数据库代码里面的，因为一个系统要给别人用的话，基本是有很多用户，并且用户会配置角色权限等。

本章中，细心的朋友发现了 Spring security会使用csrf来进行安全的校验，那我们怎么用前后端分离模式来解决这些呢，这个在后面也会进行讲解？