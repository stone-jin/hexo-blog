---
title: （maven系列）编写第一个maven插件
cover: https://img.zcool.cn/community/011e475b86a540a80120245c336724.jpg@1280w_1l_2o_100sh.jpg
subtitle: 学习maven插件，想要了解在maven编译过程中的插件这块
date: 2018-06-13 20:37:13
author: 
  nick: 金炳
  link: https://www.github.com/stone-jin
categories:
- 后端
tags:
- JAVA
- MAVEN
---

## 一、背景
最近在做接口管理平台的事情，接口管理平台的方案，采用后端java项目集成swagger，然后将swagger离线化部署到接口管理平台上。然后前端在这个平台上，可以查看后端定义的接口，同时平台上提供对应的mock数据，还可以根据这个接口生成前端的sdk，不需要再去关心ajax那块。当后端接口变动的时候，我们只需要生成新的前端的SDK。

然后问题是，为了能让后端项目不需要改动，想法：如果到了class级别肯定已经无法获取到其中的javadoc的注释了，那想的时候，就是要么做一个maven的plugin，要么做一个intellij的插件。所以本文先做技术积累，做一个maven的插件试试。

## 二、maven插件开发入门

第一步：

通过intellij idea新建一个maven工程

第二步：

修改pom.xml文件，将packaging设置为maven-plugin

第三步：

我们平常执行的mvn *****的操作，我们其实在执行Mojo，

所以我们新建我们第一个MoJo，

```java
/**
 * @goal buildinfo
 * @phase  pre-integration-test
 */
public class BuildInfoMojo extends AbstractMojo {

    /**
     * @parameter expression="${project}"
     * @readonly
     */
    private MavenProject mavenProject;

    /**
     * @parameter expression="${buildinfo.prefix}"
     * default-value="+++"
     */
    private String prefix;

    public void execute() throws MojoExecutionException, MojoFailureException {
    }
}
```

然后实现其中接口类里面的execute函数，此处我们打印一下我们执行mvn时候，代码路径和输出的路径，和测试代码路径和测试结果输出的路径：
```java
public void execute() throws MojoExecutionException, MojoFailureException {
    Build build = mavenProject.getBuild();
    String outputDirectory = build.getOutputDirectory();
    String sourceDirectory = build.getSourceDirectory();
    String testOutputDirectory = build.getTestOutputDirectory();
    String testSourceDirectory = build.getTestSourceDirectory();
    getLog().info("\n==============\n Project build info.");

    String[] info = {outputDirectory, sourceDirectory, testOutputDirectory, testSourceDirectory};
    for(String item: info){
        getLog().info("\t"  + "   " + item);
    }
    getLog().info("=============");
}
```

然后编写完毕后，我们本地通过mvn clean install安装到本地的maven环境中。

然后就此我们已经编写完一个最简单的maven插件了。

第四步：测试下我们的插件：

通过执行mvn {groupId}:{artifactId}:{version}:buildinfo

最终我们可以看到下面这样的效果：

```java
[INFO] Scanning for projects...
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] Building demo-maven-plugin 1.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- demo-maven-plugin:1.0-SNAPSHOT:buildinfo (default-cli) @ demo-maven-plugin ---
[INFO] 
==============
 Project build info.
[INFO]     /Users/stone-jin/code/local/java/demo-maven-plugin/target/classes
[INFO]     /Users/stone-jin/code/local/java/demo-maven-plugin/src/main/java
[INFO]     /Users/stone-jin/code/local/java/demo-maven-plugin/target/test-classes
[INFO]     /Users/stone-jin/code/local/java/demo-maven-plugin/src/test/java
[INFO] =============
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 0.488 s
[INFO] Finished at: 2018-06-13T20:13:55+08:00
[INFO] Final Memory: 9M/245M
[INFO] ------------------------------------------------------------------------
```
就此我们第一个maven插件书写完毕

然后我们再将我们的maven插件发布到maven仓库中，这个发布，可以通过查看：https://www.520stone.com/page/article/34

最后我们新建一个springboot的工程测试下：

放在pom包里面的build里面的plugins里面

```text
<plugin>
   <groupId>com.netease.mail</groupId>
   <artifactId>demo-maven-plugin</artifactId>
   <version>1.0-SNAPSHOT</version>
</plugin>
```

然后我们再执行下我们的maven的操作，完美可以运行

同时我们可以在intellij idea右边有个maven project中，里面有个plugins可以看到我们写的buildinfo的插件在那里。

三、结束语
最近好久没有写文章，哈哈哈，写起来~

这个代码放在：https://github.com/stone-jin/demo-maven-plugins 上了。