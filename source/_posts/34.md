---
title: maven发布项目到私服-snapshot快照库和release发布库的区别和作用及maven常用命令
cover: https://img.zcool.cn/community/011e475b86a540a80120245c336724.jpg@1280w_1l_2o_100sh.jpg
subtitle: maven发布项目到私服-snapshot快照库和release发布库的区别和作用及maven常用命令
date: 2018-05-14 20:6:36
author: 
  nick: 金炳
  link: https://www.github.com/stone-jin
categories:
- 后端
tags:
- JAVA
- MAVEN
---

在日常的工作中由于各种原因，会发生这样一种情况，某些项目并没有打包至mvnrepository。如果采用直接打包放到lib目录的方式进行处理，便对项目的管理带来一些不必要的麻烦。例如版本升级后需要重新打包并替换原有jar包等等一些额外的工作量和麻烦。为了避免这些不必要的麻烦，通常我们会通过Nexus搭建私有的仓库。下面着重介绍下怎么通过mvn命令将程序打包并发布到私有仓库Nexus中。

前提：

1.已成功安装maven

2.已成功安装Nexus（管理账号：admin，密码：admin123，搭建方式我写了一篇文章：[https://www.520stone.com/page/article/35](https://www.520stone.com/page/article/35)）

3.项目通过maven进行管理

maven安装目录下setting.xml中添加如下配置：

servers节点中添加：

```text
<server>
    <id>releases</id>
    <username>admin</username>
    <password>admin123</password>
</server>
<server>
    <id>snapshots</id>
    <username>admin</username>
    <password>admin123</password>
</server>
```

注意：如果非admin用户，需要在Nexus中对相应的账号设置密码

1.打开安全设置：[http://localhost:8081/nexus/#security-users](http://localhost:8081/nexus/#security-users)

2.选择相应的用户--》右键--》reset password/set password --》进行密码设置

3.相应的仓库允许重复发布（Repository--》选择对应的仓库--》Configuration--》Deployment Policy下拉选项中选择“Allow Redeoploy”），如果不允许重复发布，重复发布时会出现401等异常情况。

项目下pom.xml中添加如下内容：

```text
<!-- 项目发布管理 -->
<distributionManagement>
  <repository>
    <id>releases</id>
    <name>User Project Release</name>
    <url>http://127.0.0.1:8081/nexus/content/repositories/releases/</url>
  </repository>

  <snapshotRepository>
    <id>snapshots</id>
    <name>User Project SNAPSHOTS</name>
    <url>http://127.0.0.1:8081/nexus/content/repositories/snapshots/</url>
  </snapshotRepository>
</distributionManagement>
```

发布到私服

切换到项目根目录后运行：
```text
mvn clean deploy -X -Dmaven.test.skip=true
```即可。如果发布成功会出现BUILD SUCCESS的字样。查看仓库http://127.0.0.1:8081/nexus/content/repositories/releases/已经包含了相应的包。

注意：

如果想发布到snapshot仓库中，则需要在版本号后加上—SNAPSHOT（注意这里必须是大写）

如：

```text
<groupId>cc.mzone</groupId>
<artifactId>m1</artifactId>
<version>0.1-SNAPSHOT</version>
<packaging>jar</packaging>
```

maven中snapshot快照库和release发布库的区别和作用

在使用maven过程中，我们在开发阶段经常性的会有很多公共库处于不稳定状态，随时需要修改并发布，可能一天就要发布一天，遇到bug时，甚至一天要发布N此。我们知道，maven的依赖管理是基于版本管理的，对于发布状态的artifact，如果版本号相同，即使我们内部的镜像服务器上的组件比本地新，maven也不会主动下载的。如果我们在开发阶段都是基于正式发布版本来做依赖版本，name遇到这个问题，就需要升级组件的版本号，可这样就明显不符合要求和实际情况了。但是，如果是基于快照版本，name问题就自然而然的解决了，而maven已经为我们准备好了这一切。

maven中的仓库分为两种，snapshot快照仓库和release发布仓库。snapshot快照仓库用于保存开发过程中的不稳定版本，release正式仓库则是用来保存稳定的发布版本。定义一个组件/模块为快照版本，只需要在pom文件中在该模块的版本号后加上 -SNAPSHOT即可（注意这里必须是大写），如下：

```text
<groupId>cc.mzone</groupId>
<artifactId>m1</artifactId>
<version>0.1-SNAPSHOT</version>
<packaging>jar</packaging>
```

maven2会根据模块的版本号（pom文件中的maven）中是否带有-SNAPSHOT来判断是否是快照版本还是正式版本。如果是快照版本，name在mvn deploy时会自动发布到快照版本库中，二使用快照版本的模块，在不更改版本的情况下，直接编译打包时，maven会自动从镜像仓库服务器上下载最新的快照版本。如果是正式发布版本，name在mvn deploy时会自动发布到正式版本库中，二使用正式版本的模块，在不更改版本的情况下，编译打包时如果已经存在该版本的模块则不会主动去镜像服务器上下载。

jar包发布到指定仓库

```text
mvn deploy:deploy-file -DgroupId=com.xy.oracle -DartifactId=ojdbc14 -Dversion=10.2.0.4.0 -Dpackaging=jar -Dfile=E:\ojdbc14.jar -Durl=http://127.0.0.1:8081/nexus/content/repositories/thirdparty/ -DrepositoryId=thirdparty
```

jar包发布到本地缓存仓库

```text
mvn clean install
```

注意：

1. 如果出现400，需要注意项目下的pom.xml文件和maven使用的setting.xml文件的配置是否一致。
2. 如果出现401，需要检查maven使用的setting.xml中的账号和密码是否正确，相应的repository是否为ALLow redeploy
3. 如果使用的intellij，eclipse或myeclipse需要注意ide中使用的setting.xml和maven命令行下的setting.xml是否一致；否则会出现许多莫名其妙的问题。

原文地址：[https://www.cnblogs.com/rwxwsblog/p/6029636.html](https://www.cnblogs.com/rwxwsblog/p/6029636.html)