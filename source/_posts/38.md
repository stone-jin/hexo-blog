---
title: 关于let sencrypt过期的问题处理
cover: https://img.zcool.cn/community/011e475b86a540a80120245c336724.jpg@1280w_1l_2o_100sh.jpg
subtitle: 给自己的服务器配置https，免费的我们使用let sencrypt
date: 2018-06-25 23:46:44
author: 
  nick: 金炳
  link: https://www.github.com/stone-jin
categories:
- 服务器配置
tags:
- 服务器
- 环境配置
---

## 一、问题介绍
由于当前站点的https采用的是let sencrpt，let sencrpt是每90天需要认证一下，然后最近发现我的https过期了，然后在服务器上面执行我的续期脚本，也报错了。
```text
./letsencrypt-auto certonly --renew-by-default --email hzjinbing@163.com -d www.520stone.com
```

然后报错内容如下：

```text
Saving debug log to /var/log/letsencrypt/letsencrypt.log

How would you like to authenticate with the ACME CA?
-------------------------------------------------------------------------------
1: Apache Web Server plugin - Beta (apache)
2: Nginx Web Server plugin - Alpha (nginx)
3: Spin up a temporary webserver (standalone)
4: Place files in webroot directory (webroot)
-------------------------------------------------------------------------------
Select the appropriate number [1-4] then [enter] (press 'c' to cancel): 2
Plugins selected: Authenticator nginx, Installer None
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for www.520stone.com
Waiting for verification...
Cleaning up challenges
Failed authorization procedure. www.520stone.com (tls-sni-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Incorrect validation certificate for tls-sni-01 challenge. Requested 8b01252f05bfcb35a2d586933f89613e.d6b3afaf871b282ab64f7c74c0886f2f.acme.invalid from 139.196.95.206:443. Received 2 certificate(s), first certificate had names "www.520stone.com"

IMPORTANT NOTES:
 - The following errors were reported by the server:

   Domain: www.520stone.com
   Type:   unauthorized
   Detail: Incorrect validation certificate for tls-sni-01 challenge.
   Requested
   8b01252f05bfcb35a2d586933f89613e.d6b3afaf871b282ab64f7c74c0886f2f.acme.invalid
   from 139.196.95.206:443. Received 2 certificate(s), first
   certificate had names "www.520stone.com"

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address.
```
所以报错已经在这边了，我们就需要解决他，否则当前博客本来好不容易积累的每天的dau就降下来了。

## 二、问题原因
当前还未解决，最近记录下这个解决过程。

最终阿里云服务器上面过了几天后，我使用下面这个代码最终续期成功了。先记录下这个脚本。

```text
#!/bin/bash
../code/letsencrypt/letsencrypt-auto certonly --renew-by-default --email hzjinbing@163.com -d www.520stone.com
```

然后最终我是使用nginx，所以中间有一个项，选择2是nginx，然后回车后最终续期成功了。